<% provide :sidebar do %>
  <ul class="leftmenu">
    <li class="selected"><%= link_to(t('contacts.mine.my_contacts'), "/contacts/mine") %></li>
  </ul>
<% end %>
<div class="controlbar">
  <%= link_to("Back to profile", '/contacts/mine', :class=>"backto") %>
</div>
<div class="titlebar">
  <h1>
    <%= image_tag("contact.png") %>
    <%= @person %>
  </h1>
</div>

<div class="pad">
  
  <div class="contact_leftcol">
    <div>
      <%# if @person.fb_uid.present? %>
        <%= image_tag("https://graph.facebook.com/#{@person.fb_uid}/picture?type=large", alt: '') %>
      <%# else %>
        <!-- No Image because they don't have facebook connected -->
      <%# end %>
    </div>
  </div>

  <div class="contact_rightbody">
    <%= form_for @person, url: contact_path(@person), method: :put do |f| %>
      <% if flash[:error] %>
        <div class="flash error"><%= raw flash[:error] %></div>
      <% end %>
      
      <h2 class="form_section">Basic Information</h2>
      <%= render 'people/person_form', person: @person %>
      
      <br/>
      <hr/>
      
      <div class="user_defined_contact_fields">   
        <h2 class="form_section">Additional Information</h2>       
        <% current_organization.question_sheets.flatten.uniq.each do |qs| %>
          <% answer_sheet = @person.answer_sheets.detect {|as| qs.id == as.question_sheet_id} %>
          <% qs.questions.each do |question| %>
            <% next if ['email','phone'].include?(question.slug) %>
            <% answer = question.display_response(answer_sheet) %>
        
            <div class="field">
            	<label><%= raw question.label %></label>
            	<%= render :partial => 'questions/' + question.ptemplate, object: question, locals: {col: nil, answer_sheet: answer_sheet} %>
            </div>
          <% end %>
        <% end %>
      </div>
      <div class="formactions">
        <%= submit_tag 'Save' %>
        <%= link_to("Cancel and go back to profile", "", :class => "cancel")%>
      </div>
    <% end %>
  </div>
</div>