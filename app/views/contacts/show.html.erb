<% provide :sidebar do %>
  <ul class="leftmenu">
    <li class="selected"><%= link_to(t('contacts.mine.my_contacts'), "") %></li>
  </ul>
<% end %>

<%= form_for ContactAssignment.new, html: {style: 'display:none'} do |f| %>
  <%= check_box_tag 'ids[]', @person.id, true, id: "ids_#{@person.id}", class: 'id_checkbox' %>
  <%= hidden_field_tag :assign_to %>
  <%= render 'assign' %>
<% end %>
<div class="titlebar">
  <h1>
    <%= image_tag("contact.png") %>
    <%= @person %>
    <ul class="pillmenu">
      <li><%= link_to("Assign", "", class: 'assign', 'data-id' => @person.id) %></li>
    </ul>
  </h1>
</div>

<div class="pad">
  
  <div class="contact_leftcol">
    <div>
      <%# if @person.fb_uid.present? %>
        <%= image_tag("https://graph.facebook.com/#{@person.fb_uid}/picture?type=large", alt: '') %>
      <%# else %>
        <!-- No Image because they don't have facebook connected -->
      <%# end %>
    </div>
    <div>
      <% if @person.phone_number.present? %>
        <%= t('contacts.show.phone_number') %>: <%= number_to_phone(@person.phone_number) %><br/>
      <% end %>
      <% if @person.email.present? %>
        <%= t('contacts.show.email') %>: <%= mail_to(@person.email) %><br/>
      <% end %>
      <% if @person.current_address %>
        <p><%= raw @person.current_address.display_html %></p>
        <%= link_to('Google Map', @person.current_address.map_link, target: '_blank', :class => "maplink") %>
      <% end %>
      <% if @person.fb_uid.present? %>
      <p><%= link_to('Facebook Profile', "http://www.facebook.com/profile.php?id=#{@person.fb_uid}", target: '_blank') %></p>
      <% end %>
      <p><%= link_to('Survey Answers', '', id: 'survey_answers_link') %></p>
      <div id="survey_answers" style="display:none" title="Survey Answers">
        <ul>
          <% @organization.questions.where("#{PageElement.table_name}.hidden" => false).flatten.uniq.each do |q| %>
            <% answer_sheet = @person.answer_sheets.detect {|as| q.question_sheets.collect(&:id).include?(as.question_sheet_id)} %>
            <li><%= q.label %>: <%= q.display_response(answer_sheet) %></li>
          <% end %>
        </ul>
      </div>
    </div>
  </div>

  <div class="contact_rightbody">
    <%= form_for @followup_comment, remote: true, html: {id: 'comment_form'} do |f| %>
      <%= f.hidden_field :organization_id %>
      <%= f.hidden_field :contact_id %>
      <%= f.hidden_field :commenter_id %>
      <span class="statusline">
        <%= t('contacts.show.status') %>: 
        <%= f.select :status, OrganizationMembership::FOLLOWUP_STATUSES.collect {|s| [t("contacts.statuses.#{s}"), s]} %><br/>
      </span>
      <div class="commentbox">
        <div class="textarea">
          <%= f.text_area :comment, :rows => "2", placeholder: 'Add comments here...' %><br/>
        </div>
        <%= f.submit t('contacts.show.add_comment'), id: 'comment_submit' %><%= spinner('comment') %>
        <div class="rejoiceablebox">
          <%= link_to(t('contacts.show.attach_rejoicable'), '#', id: 'add_rejoicable') %><br/>
          <div id="rejoicable_fields" style="display:none">
            <% Rejoicable::OPTIONS.each do |option| %>
              <%= check_box_tag 'rejoicables[]', option %> <%= t("rejoicables.#{option}") %>
              <br/>
            <% end %>
          </div>
        </div>        
      </div>
      
    <% end %>
    
    <div class="commentswall">
      <h3>Previous Comments</h3>
      <ul id="previous_comments">
        <%= render partial: 'followup_comments/followup_comment', collection: @followup_comments %>
      </ul>
    </div>
  </div>
</div>