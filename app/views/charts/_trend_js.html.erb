<script>
  $(function () {

    // Parse the data from an inline table using the Highcharts Data plugin
    $('#trend_container').highcharts({

      chart: {
        type: 'line'
      },

      title: {
        text: null
      },

      pane: {
        size: '100%',
        startAngle: -180,
        endAngle: 90
      },

      legend: {
        enabled: false,
        align: 'right',
        verticalAlign: 'top',
        layout: 'vertical'
      },

      xAxis: {
        type: 'datetime',
        min: Date.UTC(<%= @begin_date.year %>, <%= @begin_date.month - 1 %>, <%= @begin_date.day %>),
        max: Date.UTC(<%= @end_date.year %>, <%= @end_date.month - 1 %>, <%= @end_date.day %>),
        tickInternal: 7 * 24 * 3600 * 1000,
        gridLineWidth: 1
      },

      yAxis: {
        title: {
          text: null
        },
        min: 0,
        type: 'linear',
        endOnTick: false,
        showLastLabel: true
      },

      tooltip: {
        followPointer: true
      },

      plotOptions: {

        column: {
          grouping: false
        },

        series: {
          shadow: false,
          groupPadding: 0,
          pointPlacement: 'on'
        }
      },
      series: [{
        <% @fields.each do |field| %>
          data: [{
            <% line = @lines[field] %>
            <% line.each_key do |date| %>
              x: Date.UTC(<%= date.year %>, <%= date.month - 1 %>, <%= date.day %>),
              y: <%= line[date] %>
            <% unless date == line.keys.last %>
              },
              {
            <% end %>
          <% end %>
          }],
          name: '<%= field %>'
        <%= "}, {" unless field == @fields.last %>
        <% end %>
      }]
    });
  });
</script>