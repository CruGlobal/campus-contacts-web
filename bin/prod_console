#!/bin/bash

git fetch origin master > /dev/null 2>&1
branch_name=$(git rev-parse --abbrev-ref HEAD) 
commit_changes=$(git log HEAD..origin/master --oneline)
git_diff=$(git diff origin/master)

if [[ $branch_name != "master" ]]; then
  echo You must be on master to run a production console.
  echo First run:  git checkout master
elif [[ $commit_changes != "" ]]; then
  echo Your local master branch is not up to date with origin/master.
  echo First run:  git pull origin master
elif [[ $git_diff != "" ]]; then
  echo Your have made local changes to the master branch.
  git status
  echo First run: \"git stash\" or \"git reset --hard\"  \(overwrites changes\)
else
  RAILS_ENV=production DISABLE_SPRING=1 env $(cat .env.production | xargs) bundle exec rails c
fi
